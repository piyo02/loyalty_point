<?xml version="1.0" encoding="utf-8"?>
<odoo>

        <record id="view_partner_loyalty_form" model="ir.ui.view">
            <field name="name">res.partner.loyalty.form.view</field>
            <field name="model">res.partner</field>
            <field name="priority">10</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <page name="sales_purchases" position="after">
                    <page string="Loyalty" name="loyalty">
                        <group>
                            <group string="Loyalty" name="loyalty_form">
                                <field name="member_status"/>
                                <field name="card_number" attrs="{'invisible': [('member_status', '=', False)]}"/>
                                <field name="member_loyalty_level_id" attrs="{'invisible': [('member_status', '=', False)]}"/>
                                <field name="total_points" attrs="{'invisible': [('member_status', '=', False)]}"/>
                            </group>
                            <group attrs="{'invisible': [('member_status', '=', False)]}">
                                <field name="remaining_loyalty_amount"/>
                                <field name="remaining_loyalty_points"/>
                                <field name="total_remaining_points"/>
                            </group>
                        </group>
                    </page>
                </page>
            </field>
        </record>

        <record id="view_loyalty_point_history_tree" model="ir.ui.view">
            <field name="name">loyalty.point.record.tree</field>
            <field name="model">loyalty.point.record</field>
            <field name="priority">2</field>
            <field name="arch" type="xml">
                <tree string="Loyalty Point" create="0">
                    <field name="pos_order_id" attrs="{'invisible': [('pos_order_id', '=', False)]}"/>
                    <field name="sale_order_id" attrs="{'invisible': [('sale_order_id', '=', False)]}"/>
                    <field name="points"/>
                    <field name="expired_date"/>
                </tree>
            </field>
        </record>

        <record id="act_res_partner_2_loyalty_point" model="ir.actions.act_window">
            <field name="name">Loyalty Point</field>
            <field name="res_model">loyalty.point.record</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="view_loyalty_point_history_tree"/>
            <field name="context">{'search_default_partner_id': active_id}</field>
        </record>

        <record model="ir.actions.act_window.view" id="action_loyalty_point_history_tree">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_loyalty_point_history_tree"/>
            <field name="act_window_id" ref="act_res_partner_2_loyalty_point"/>
        </record>

        <record id="res_partner_view_buttons_loyalty_point" model="ir.ui.view">
            <field name="name">res.partner.view.buttons</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form" />
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <div name="button_box" position="inside">
                    <button class="oe_stat_button" type="action" name="%(loyalty_point.act_res_partner_2_loyalty_point)d" 
                        attrs="{'invisible': [('member_status', '=', False)]}"
                        icon="fa-usd">
                        <field string="Loyalty" name="loyalty_point_count" widget="statinfo"/>
                    </button>     
                </div>
            </field>
        </record>

</odoo>
